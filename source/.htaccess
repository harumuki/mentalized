RewriteEngine on

# Remove www
RewriteCond %{HTTP_HOST} ^www\.mentalized\.net$ [NC]
RewriteRule ^(.*)$ http://mentalized.net/$1 [R=301,L]

# Deny hotlinking
# Only allow requests to images in the journal from specified referrers (or none).
RewriteCond %{HTTP_REFERER}                         !^$
RewriteCond %{HTTP_REFERER}                         !^http://(www\.)?mentalized.net/.*$ [NC]
RewriteCond %{HTTP_REFERER}                         !^http://mentalized.net/.*$ [NC]
RewriteRule ^journal/.*\.(gif|GIF|png|PNG|jpg|JPG)$ - [F]

# Send all requests to .html
RewriteRule ^(.*)\.asp $1.html [R=301]
RewriteRule ^(.*)\.php $1.html [R=301]

# Strip index.html from URLs
RewriteRule (.*)/index.html  /$1/ [R=301]

# Yearly archives are no more, redirect to the first montly archive of the year
RewriteRule ^journal/(\d\d\d\d)/?$  /journal/$1/01

# The GOOG recommends dashes instead of underscores
RewriteRule ^(journal/\d*/\d*/\d*/[^/]*?)_(.*)$       /$1-$2 [R=301]

# Redirect stuff that shows up as 404s
RewriteRule ^about/contact/?$                                                 /about [R=301]
RewriteRule ^about/resume/?$                                                  /about [R=301]
RewriteRule ^activity-indicators/indicators(/*)                               /activity-indicators/ [R=301]
RewriteRule ^docs/projects/j-referrertracker(/.*)$                            /journal/2003/01/27/announcing-jreferrertracker$1 [R=301]
RewriteRule ^journal(/?)$                                                     /journal/archives/
RewriteRule ^journal/2003/06/18/stupid-antileech-protection(/*)               /journal/2003/06/18/stupid-anti-leech-protection/ [R=301]
RewriteRule ^journal/2003/08/25/wwwnikenoyoucantplaycom(/*)                   /journal/2003/08/25/wwwnike-no-you-cant-playcom/ [R=301]
RewriteRule ^journal/2005/04/15/notetagger-the-introduction(/*)               /journal/2005/04/15/notetagger-the-introduction/ [R=301]
RewriteRule ^journal/2005/04/27/notetagger-adding-the-ajax(/*)                /journal/2005/04/27/notetagger-adding-the-ajax/ [R=301]
RewriteRule ^journal/2005/05/18/notetagger-adding-users-and-subdomains(/*)    /journal/2005/05/18/notetagger-adding-users-and-subdomains/ [R=301]
RewriteRule ^journal/2005/10/10/building-your-very-own-web20-layou\.\.        /journal/2005/10/10/building-your-very-own-web20-layout/ [R=301]
RewriteRule ^journal/2005/10/building-your-very-own-web20-layout(/.*)?        /journal/2005/10/10/building-your-very-own-web20-layout/ [R=301]
RewriteRule ^journal/2005/10/14/pick-your-age-(.+)                            /journal/2005/10/14/pick-your-age/ [R=301]
RewriteRule ^journal/2006/01/24/no-such-file-to-load----mkmf(/*)              /journal/2006/01/24/no-such-file-to-load-mkmf/ [R=301]
RewriteRule ^journal/2006/07/28/run-specific-(/.*)?$                          /journal/2006/07/28/run-specific-tests-via-rake/ [R=301]
RewriteRule ^journal/2006/10/24/browser-size-does-matter-actual-numbers(/*)   /journal/2006/10/24/browser-size-does-matter-actual-numbers/ [R=301]
RewriteRule ^journal/2006/10/24/size-does-matter-actual-numbers(/*)           /journal/2006/10/24/browser-size-does-matter-actual-numbers/ [R=301]
RewriteRule ^journal/2007/06/25/fixing-freetds-on-os-x-like-a-rubywielding-ostrich-would(/*)    /journal/2007/06/25/fixing-freetds-on-os-x-like-a-ruby-wielding-ostrich-would/ [R=301]
RewriteRule ^journal/2007/07/03/what-the-heck-is-an-iphone-application(/*)    /journal/2007/07/03/what-the-heck-is-an-iphone-application/ [R=301]
RewriteRule ^journal/2008/05/27/stikipad-when-software-in-th(\.\.\.)?         /journal/2008/05/27/stikipad-when-software-in-the-cloud-goes-sour/ [R=301]
RewriteRule ^journal/2008/10/16/immediatefeedbackformatter-better-formatted-rspec-output(/*)    /journal/2008/10/16/immediatefeedbackformatter-better-formatted-rspec-output/ [R=301]
RewriteRule ^journal/2009/08/03/redmine(/.*)?$                                /journal/2009/08/03/redmine-plugin-github-hook/ [R=301]
RewriteRule ^journal/2010/02/17/webkitbased-xbox-dashboard(/*)                /journal/2010/02/17/webkit-based-xbox-dashboard/ [R=301]
RewriteRule ^journal/2010/10/16/rails-rumble-2010/                            /journal/2010/10/17/rails-rumble-2010/ [R=301]
RewriteRule ^journal/2011/05/18/pileup-carousel(/.*)?                         /journal/2011/05/18/experiment-pileup-carousel/ [R=301]
RewriteRule ^journal/2011/05/24/silencing-postgresql/                         /journal/2011/05/24/how-to-silence-postgresql-in-rails/ [R=301]
RewriteRule ^journal/archives/movielink(/*)                                   /journal/2002/11/11/us-customers-only-please/ [R=301]
RewriteRule ^journal/archives/technology/bogus-referrers(/*)                  /journal/2003/03/19/bogus-referrers$1 [R=301]
RewriteRule ^journal/archives/technology/musical-dinosaurs/                   /journal/2002/10/23/musical-dinosaurs/ [R=301]
RewriteRule ^journal/archives/technology/tweaking-the-website/                /journal/2003/01/27/tweaking-the-website/ [R=301]
RewriteRule ^journal/life/and-so-my-birthday-came-to-pass(/.*)                /journal/2003/06/23/and-so-my-birthday-came-to-pass$1 [R=301]
RewriteRule ^journal/movabletype/index.xml                                    /journal/entries.xml [R=301]
RewriteRule ^journal/movies/us-customers-only-please(/*)                      /journal/2002/11/11/us-customers-only-please$1 [R=301]
RewriteRule ^journal/technology/adjusting-ergonomically(/*)                   /journal/2002/08/22/adjusting-ergonomically$1 [R=301]
RewriteRule ^journal/technology/bogus-referrers(/.*)$                         /journal/2003/03/19/bogus-referrers$1 [R=301]
RewriteRule ^journal/technology/creating-color-schemes(/*)                    /journal/2003/08/08/creating-color-schemes$1 [R=301]
RewriteRule ^journal/technology/google-rocks-my-world(/.*)$                   /journal/2003/08/12/google-rocks-my-world$1 [R=301]
RewriteRule ^journal/technology/i-wonder-what-all-the-rss-fuss-is-about(/.*)  /journal/2003/05/05/i-wonder-what-all-the-rss-fuss-is-about$1 [R=301]
RewriteRule ^journal/technology/phonecam-to-blog-in-7-keypresses(/*)          /journal/2003/04/01/phonecam-to-blog-in-7-keypresses$1 [R=301]
RewriteRule ^journal/technology/scrap-those-pixels(/*)                        /journal/2003/08/08/scrap-those-pixels$1 [R=301]

# Process requests to the defunct CSS Depot
RewriteRule cssdepot/layouts(.*)  /cssdepot/index.html

# Strip archives from oldstyle links to the journal archives
RewriteRule ^journal/archives/(.+)$                           /journal/$1 [R=301]
RewriteRule ^journal/quicklinks/archives/(\d+/\d+/\d+)/(.*)/  /journal/quicklinks/$1/link/ [R=301]

# Send requests for the deprecated features section to the relevant pages in the journal
RewriteRule ^features/everquest/omens-of-war-armor-quests(/.*)                /journal/2004/11/03/omens-of-war-armor-quests$1 [R=301]
RewriteRule ^features/elsewhere/splinter-cell-pandora-tomorrow-review(/.*)    /journal/2004/05/19/splinter-cell-pandora-tomorrow-review$1 [R=301]
RewriteRule ^features/everquest/ssraeshza-temple-notes(/.*)                   /journal/2004/03/05/ssraeshza-temple-notes$1 [R=301]
RewriteRule ^features/everquest/alternate-advancement-aa-titles(/.*)          /journal/2004/02/04/alternate-advancement-aa-titles$1 [R=301]
RewriteRule ^features/everquest/10th-ring-war-overview(/.*)                   /journal/2003/10/04/10th-ring-war-overview$1 [R=301]
RewriteRule ^features/elsewhere/world-of-warcraft-preview(/.*)                /journal/2001/09/05/world-of-warcract-preview$1 [R=301]
RewriteRule ^features/everquest/class-titles(/.*)                             /journal/2003/07/30/everquest-class-titles$1 [R=301]
RewriteRule ^features/everquest/the-iksar-handbook-of-infiltration(/.*)       /journal/2003/07/30/the-iksar-handbook-of-infiltration$1 [R=301]
RewriteRule ^features/movable-type/power-your-website-with-movable-type(/.*)  /journal/2003/08/01/power-your-website-with-movable-type$1 [R=301]
RewriteRule ^features/everquest/velious-custom-helmets(/.*)                   /journal/2003/08/26/velious-custom-helmets$1 [R=301]
RewriteRule ^features/projects/asptunetracker(/.*)                            /journal/2003/09/01/asptunetracker$1 [R=301]
RewriteRule ^features/elsewhere(/?)                                           /journal/ [R=301]
RewriteRule ^features/everquest(/?)                                           /journal/games/ [R=301]
RewriteRule ^features/projects(/?)                                            /journal/projects/ [R=301]
RewriteRule ^features(/?)                                                     /journal/ [R=301]

